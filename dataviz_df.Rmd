---
title: "DataVis_Group_Final"
output: html_document
date: "2023-11-19"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(gapminder)
library(readr)
library(tidyr)
library(dplyr)
library(ggplot2)


gdp_per_capita <- read_csv("C:/Users/91981/Downloads/gdppercapita_us_inflation_adjusted.csv")
df_finance <- read_csv("C:/Users/91981/Downloads/finance_final.csv")
final_overall <- read_csv("C:/Users/91981/Downloads/final_overall.csv")
int_games <- read_csv("C:/Users/91981/Downloads/int_games.csv")
df_dom <- read_csv('C:/Users/91981/Downloads/df_dom.csv')
eng_dom_win <- read_csv('C:/Users/91981/Downloads/eng_dom_win.csv')
eng_dom_loss <- read_csv('C:/Users/91981/Downloads/eng_dom_loss.csv')

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}

# Turning data from wide to long (years not as columns anymore) and dropping NAs in GDP
gdp_per_capita_clean <- gdp_per_capita %>% 
  pivot_longer(cols = -country, names_to = "year", values_to = "gdp") %>% # Every column (all years) except for country
  drop_na(gdp)

# Choosing which values end with "k" instead of numerical values (thousands) and transforming those
gdp_per_capita_clean$gdp <- ifelse(grepl("k$", gdp_per_capita_clean$gdp), as.numeric(gsub("k", "", gdp_per_capita_clean$gdp)) * 1000, as.numeric(gdp_per_capita_clean$gdp))

# Joining data with gapminder to get continent names
gdp_per_capita_continent <- gdp_per_capita_clean %>% 
  left_join(select(gapminder, country, continent), by = "country") %>% # Only joining with country and continent columns of gapminder
  group_by(continent, year) %>% 
  summarise(avg_gdp_per_cap = mean(gdp)) # Mean GDP per capita when grouped by continent and year

glimpse(gdp_per_capita_continent)

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r}

matches_per_year <- df_dom %>% 
  filter(year>2000, continent %in% c('Africa', 'Asia', 'North America', 'Europe', 'South America', 'Oceania'), year<=2019) %>% 
  group_by(continent, year) %>% 
  summarise(Count = n()) %>% 
  ungroup() %>% 
  ggplot(aes(x=year, y = Count, fill = continent)) + geom_bar(stat='identity', position = 'dodge')

matches_per_year

```
```{r}
plot1 <- gdp_per_capita_continent %>% 
  mutate(year=  as.integer(year)) %>% 
  filter(year >=2000, continent %in% c('Africa', 'Asia', 'North America', 'Europe')) %>% 
  drop_na(avg_gdp_per_cap)
```


```{r}

# Adding the line plot
# Replace 'gdp_data', 'year', 'avg_gdp_per_cap', and 'continent' with your actual dataset and column names
matches_per_year <- matches_per_year +
                    geom_line(data = plot1, aes(x = year, y = avg_gdp_per_cap, color = continent))

# Display the plot
matches_per_year

```


```{r}
# Load necessary libraries
library(dplyr)
library(ggplot2)

# Filter for matches involving England
england_matches <- int_games %>%
  filter(home_team == 'England' | away_team == 'England')

# Determine the winner of each match
england_matches <- england_matches %>%
  mutate(winner = case_when(
    home_score > away_score & home_team == 'England' | away_score > home_score & away_team == 'England' ~ 'England',
    home_score == away_score ~ 'Draw',
    TRUE ~ 'Opponent'
  ))

# Convert date to Year and filter for 2001 to 2019
england_matches <- england_matches %>%
  mutate(year = as.numeric(format(as.Date(date, "%Y-%m-%d"), "%Y"))) %>%
  filter(year >= 2001, year <= 2019)

# Calculate win percentage by year
win_percentage_by_year <- england_matches %>%
  group_by(year) %>%
  summarize(win_percentage = mean(winner == 'England') * 100)

# Plotting
ggplot(win_percentage_by_year, aes(x = year, y = win_percentage)) +
  geom_line(color = "#141E46", size = 1.5, alpha = 0.8) + # Increased line thickness
  geom_point(color = "#C70039", size = 4, alpha = 0.92) +
  scale_x_continuous(breaks = win_percentage_by_year$year) + 
  theme_minimal() +
   theme(panel.background = element_rect(fill = "#FFF5E0", color = NA), # Change panel background
        plot.background = element_rect(fill = "#FFF5E0", color = NA), # Change plot background
        panel.grid.minor = element_blank(),
        panel.border = element_blank()) + # Remove background grids
  labs(title = "England Football Team Win Percentage (2001 - 2019)",
       x = "Year",
       y = "Win Percentage")
```


```{r}
library(lubridate)

df_finance$date <- as.Date(df_finance$date)

# Join the datasets on the date column
combined_data_england <- left_join(england_matches, df_finance, by = "date") 
# View the first few rows of the combined dataset
length(combined_data_england)

combined_data_england$date <- ymd(combined_data_england$date) # ymd stands for "year-month-day"
# Extracting the day
combined_data_england$day <- day(combined_data_england$date)

# Extracting the month
combined_data_england$month <- month(combined_data_england$date)

```

```{r}
model <- lm(Price~  winner + tournament + month + home_team + away_team, data = combined_data_england)

# Summary of the model
summary(model)

```




```{r}
dom_england_matches <- final_overall %>%
  filter(home_country == 'england' | away_country == 'England')

england_matches <- final_overall %>%
  filter(home_country == 'england' | away_country == 'England' | home_team == 'England' | away_team == 'England') %>% 
  mutate(winner = case_when(
    home_score > away_score & home_team == 'England' | gh > ga & home_country == 'england' | gh < ga & away_country == 'england' | away_score > home_score & away_team == 'England' ~ 'England',
    home_score == away_score ~ 'Draw',
    TRUE ~ 'Opponent'
  ))

```

```{r}
x <- df_dom %>% 
  filter(year>2000, continent %in% c('Africa', 'Asia', 'North America', 'Europe', 'South America', 'Oceania'), year<=2019) %>% 
  group_by(home_country, year) %>% 
  summarise(Count = n()) %>% 
  ungroup()

write.csv(x, "C:/Users/91981/Downloads/matches_by_country.csv", row.names=FALSE)

```



```{r}


combined_data_england_2 <- combined_data_england %>%
  mutate(home_team_eng = ifelse(home_team == "England", 1, 0))


model <- lm(Price~  winner + tournament + month + home_team_eng + away_team + neutral, data = combined_data_england_2)

# Summary of the model
summary(model)


```

```{r}
install.packages("openxlsx")
library(openxlsx)

combined_data_england_2 <- combined_data_england %>%
  mutate(eng_win = ifelse(winner == "England", 1, 0))


write.xlsx(combined_data_england_2, "C:/Users/91981/Downloads/eng_win.xlsx", sheetName="Sheet1")


temp_df_eng <- combined_data_england_2 %>% 
  group_by(year,month) %>%
  filter(eng_win==1, year>2010) %>% 
  summarise(
    wins = n(),
    average_price = mean(Price, na.rm = TRUE))
```


```{r}

library(ggplot2)
library(extrafont)
library(tidyverse)
library(vroom)
library(showtext)
library(ggtext)



temp_df_eng %>% 
  filter(wins >= 2.1) %>% 
  ggplot(aes(x = wins, y = average_price)) +
  geom_point(color = "dark blue", size = 3) +
  geom_smooth(method = 'lm', se = FALSE, color = "tomato", linetype = "dashed") +
  theme_minimal() +
  labs(
    title = "English national team wins and average price of FTSE 100",
    subtitle = "We see a higher average price for FTSE 100 with more number of wins for the three lions",
    x = "Number of Wins",
    y = "Average Price"
  ) +
  scale_x_continuous(breaks = seq(min(temp_df_eng$wins), max(temp_df_eng$wins), by = 2)) +
  scale_y_continuous(breaks = seq(5000, 8000, by = 500)) +
  theme(
    text = element_text(family = "Montserrat"),  # Set the global font family
    plot.title = element_text(hjust = -0, face = "bold", size = 18, margin = margin(b = -1, unit = "pt")),
    plot.subtitle = element_text(hjust = 0, size=14, margin = margin(t = 1, unit = "pt")),
    axis.title.x = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"),
    axis.text = element_text(color = "grey15"),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.major.y = element_line(color = "gray", linetype = "dotted")
  )

```

